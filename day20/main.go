package main

import (
	"fmt"
	"strings"
)

func main() {
	part1()
	part2()
}

func part1() {
	lines := strings.Split(input, "\n")

	trans := lines[0]
	lines = lines[2:]

	onMap := map[[3]int]bool{}
	for y, line := range lines {
		for x, b := range []byte(line) {
			onMap[[3]int{x, y, 0}] = b == '#'
		}
	}

	var getpx func(x, y, iter int) bool
	getpx = func(x, y, iter int) bool {
		k := [3]int{x, y, iter}
		if v, ok := onMap[k]; ok {
			return v
		} else if iter == 0 {
			return false
		}

		idx := 0
		bit := 8
		for dy := -1; dy <= 1; dy++ {
			for dx := -1; dx <= 1; dx++ {
				x2, y2 := x+dx, y+dy
				if getpx(x2, y2, iter-1) {
					idx += 1 << bit
				}
				bit--
			}
		}

		res := trans[idx] == '#'
		onMap[k] = res
		return res
	}

	count := 0
	for y := -10; y <= len(lines)+10; y++ {
		for x := -10; x <= len(lines[0])+10; x++ {
			if getpx(x, y, 2) {
				count++
			}
		}
	}
	fmt.Println(count)
}

func part2() {
	lines := strings.Split(input, "\n")

	trans := lines[0]
	lines = lines[2:]

	onMap := map[[3]int]bool{}
	for y, line := range lines {
		for x, b := range []byte(line) {
			onMap[[3]int{x, y, 0}] = b == '#'
		}
	}

	var getpx func(x, y, iter int) bool
	getpx = func(x, y, iter int) bool {
		k := [3]int{x, y, iter}
		if v, ok := onMap[k]; ok {
			return v
		} else if iter == 0 {
			return false
		}

		idx := 0
		bit := 8
		for dy := -1; dy <= 1; dy++ {
			for dx := -1; dx <= 1; dx++ {
				x2, y2 := x+dx, y+dy
				if getpx(x2, y2, iter-1) {
					idx += 1 << bit
				}
				bit--
			}
		}

		res := trans[idx] == '#'
		onMap[k] = res
		return res
	}

	count := 0
	for y := -100; y <= len(lines)+100; y++ {
		for x := -100; x <= len(lines[0])+100; x++ {
			if getpx(x, y, 50) {
				count++
			}
		}
	}
	fmt.Println(count)
}

const input = `##........#.#.#.##.#.##...###.#.##.##.#.###..#...####..#.#.###.##....#....###..###.##..##.#.#..#....#.####..#####....##..#...##.##.....#.######.##.......##...#.#..##.#.#.#.######..##.###.#..#..###.##...#####.#....#.######.#.#..##..#.###...##.#...#.####..#.#.##..##..###..##...#.....####....###.##.#.##.#...##...#############...##.#.###.##.##.#.#####.......###.##..##..##.##.##.#..#.#..####..#####...#...#.###.##........#.##......##..###.##..#####.##........##..#.#..#.##....##.#.#..###.####.#..##...###..###.#...

......#.####.#...#..#..#.##.#...####.##..#..#..##.##........#..#####.##......#..#..##.##..#######.##
.###.##..#.########..###...#.##.#.#.#.##.#....##........#..#.#...#..#.##.##.######.##..#.#.###.###.#
.####.....##.##..#..#.#...#.###.#.###.#..##....####.#####.#..#.#.##.##.#..#..##..#.####.####....####
#.####.....#.###..#.##...##..#......#.#....#.####....#..##.........##.##########.##...##....#######.
.#####..##...#.####..####...#.#...###....#..##.##..#####.#..#......#..###.####.###.##......#....##.#
####...#.##...##..#..####.###.###.....#.##.##....#...#.###........#.#.#....#..#.###...##...#..#.##.#
###..##..###.#..#..#..#.###.##.#..###.#.#.....###.##......#..##.#...#.##..#.#########.......##....#.
#...#.#..##.#.###.#######.#...####.##.#.##.###.#.###..##.#.####..####...##.##.........#...#..#.#.#..
..#...##.#..#.##..#...#..#####.###..#.#..#..#..##.#.##.##.#####...######.#..#.###....##..####..##...
.###.####.#.#.....#.#...##.#....##.....###.###.########..##..###....######.##..##.###..#.......##...
....##.#.###..#.##.#.#.##...##.###..##.#..#...###.#...#...#..##.#....####...##.#.#..#..##.....#....#
#.##..##..##..#.##.....##.###......##..####..#..#..#..#.###.##..##.#..#.#...#.#.###.##.....#.#.#...#
...#.####.#.#.##...####.#.##..#.#.####..#.#...##..##..##....#.#.###...##...#.#.....##....##.#.#.###.
#.###...#.....##.#..##...#....##...###.##.#.##..#...#..####...####.##.#.######....#.###..#.##.##...#
..#..#..#..##.######.#..##.#####....##..##..##..##.#..####.##.##.#.###...#.###.####.#.....#.#....##.
...##.#.###....##..#######...#.......##..#.###.#...##.######...##.##...####..#.#.###.#...##.#.#.....
...##.#.....##.###....#..######..##.#...##.#....#####.........###..#.###.#.###.#......####........#.
#######...#####..#.#.###....###.#..#.#..##.#.#.##..#.#.##.#.#####.#.#.#########.##.##.#...#.##.###..
#.###.#.#.....#..###..#.#....###..#...#..####.#.....#..###..######.#.##.##.#.....#.#.#..###.###.....
#..##.#..#......#.#.#...#####.#...##..#.###.####..#...##.##..##...###..###....#.##......#....##..#..
#....##..#.##......###..##.#..#.#..##...#.##.##.#####.###.####.##.##.###...#..##.##.....#..#####....
##...#.#..###.#.##...##.#..#.#.......########.###.#.#....##.#..####..#.##.#.##.#.#..##.##..##...#...
#.###.##.##.#.#.##.###...##.##...##...####...###...#...##.###.###.##...#...##...#.#.####.#..##.##.##
##.#.##.#....#.#...###...###.##....#..##.######.###.....#..##..#..#.#.##.....###...##...#.####.#.#..
##..#...#..####.#.#..##..#...###...##.###.#..####...###..#..##....#####..##..#.##..####....##.####..
####..####..#..#.#.#..##.########......#..#.##.###.###.######........##.###.##.####...###.#####..###
##.#..#.##.#.....#........#.#.#..#.####.###..#.#..#.##...#.##.#.##.......##..####.#...........##...#
#.###.....##..#.#..####.####.#....#..#####..#..#...#..#..#.....####.#.#####.#.###...####.#...####...
#...##..#.##...#.#####.#.###.#######..#####..#..####..##.##.....###.#.####....#.#....#####...###.###
.##...#..###..#..###.#.######....#..#..#.##.###........#..##...#..#...#.#.#...###....#####...#.#####
#.#...####...###..#.#.##...##.###..####..##.###.#.#.#####...#...##.###..#.##..###....#.##....####.##
####.####..#..#..##.#.#..##..#..##....#.#.##.##..#.#.##.....#.#.#...###..####..##...###.#####..#..##
.##.##..#..#.##...####..##.....#....##.######.#..#..#..###.###..#...#.#....##....######....#..###.##
#.##..#.#.....###..##.###.###.####.#.#.##.#....##...#..#.###....##.......#..###...#.###.#..#..##...#
#..#.#####.####.##.#.#...#..##.##....#...#....##.#.##..#...##.##....##.#.##..#...###...##.#.##..###.
.#..####..###.#.##.##.##......#.##..##..###.#####.####.#.#..#######.##..###...###....#..#..#........
###..#.##..###..#.####.####.##.#..#####.##.#...##.#....#..#####...##.....#..#.#########..##..#.#..#.
##.#.#.##.......##.#####....##...#....####.....###.##.......##...#.#..#.#.##.###..###...#.##..##.###
#..#.##.#.##..#.###.....#....#.##..#....##.##..#.####.#####......#.#.#..#.....##..#..#.##.##.#...#.#
#...#.#.##....#.#.#.###.#.#....#..#.###.##...#...#..##.#..#...##...#.#.#####..##..#####.###...##..##
.#.#####..#..##.##...##.#..#.###.#.###.##.#...##..#..##.###.##....#####.#.##.....###.#.##...##..##.#
..#..####..#..#...#....#.##..##.#..#..#.#..#.#..#....####.#.....##.#.#####..#..#..######....#..#.#..
.#.###.#.#.##.#..#.###.#....##.....##..####...###.#.####...#.#.#..#.#.#..#.####.##..##.#..#.#..##..#
.###.###..##.##.##.##..#.######.####.####.....#..###......#.#........#.##.####.#..##....#.#..#..####
.##########..##..##.##.####.##.....#.#.#....##.###.#...#####..#.#..#.###.#.#...#.#....#######.....#.
#####..#.#...##...#....###...##..#..#..#.#.##.#.#.##...#.....##.#..#..####.#####....#......#.......#
#.##...#.##..#######..#.#####.#.##.##..#######.###.#..#.#..#.#.#.#...##.##.##..#....###...####.#...#
...##.#.###...##.##..###..##.####.#...#.....#..##.##.....#....#####.#..##.####.#######....###.##.#..
..##.#.....###..###.#.######.####.#####.##.#.####..###..#....#..##....#..#.#.#.....#...#..##.#..###.
#.#...###.#.#...##..##.#..##...#####.##...#####..####.#..#..#...###..#...#....#####.###.###.#...#.#.
..##...#..#.####..#...#..#.#..#.##...#...####....##.##.##.#.#..##.##....#.#..####..#..#.##..##..##.#
.##.....##.#.#...#....##..##....##...##........#..###.#...##..##..######...##...##.#####....####..##
.####...#..##.....####..#.#..#..####.##....#.#.#####..##...#....#..##.......#..#.....##.##.##..#.##.
##.#.##.#.#...#.#.##.#.####..#..#####.#.#..#.#.##...###..#...#.#.#.#..##.#..##.....##..#.###.#...#.#
#.#.#.#..#....##...#...##.#.###.#####.#..###.##.####.#.#.###...##.##.#..#.....#.#...####.##.#..##...
#.......##.#####..#.#####.######.#....##..###.#.#.#.##..####..#.#..#....#.##......#......#.#....###.
.##.#.#.....#....##.#.#.#.###.....#....##.#..#.##.#....#.###...##...##...##..##...##.#.#.#.#..#.##..
###.#...#.#.##.......#..###.#.##..#..#.##..#...##..#......#....#.#.##....#....##...###.#.###..###..#
.#..#..##...###.###.##...###.#.....#.##....##..#.###..#####.....#..####.###.##.#.#.########..##.#...
.#....#..####..##.#.##.....#.#.#.##.####.###.##.##..###..#....###.###.#.....#....#..#.#..#####.#..##
..#..#..####..##.###..#.##.....#..#..#.#..###..###...#..##...#.....#.###...#..#.##..#.#.#...##..###.
..#.#.......#..##......#...##..##.##..#.#..#.##...#.#..#.##.#..#.#...###.#......#..#....#.##.##.##..
##.##.#.#.##..#...#######.#..###...#.#.#.#.###.#....#..#.....#...#.#.###..#..###.##..#.##.##..#..#..
###.#....#..##....#...#...###...##.##.#.#.#.##..###......#....##..#.....########...#.#.#.####.#....#
####.##.####..##...#....#.#.#####.#####.#.##..###...#.##.#.###.#.##...#..##.###....#.######..##.##.#
.#......#..##....##...###...##.##.......#.#.......##....#.....#.......#...#.##..##....##...####..##.
.#.###.#.###.##..##..#.#######.##.#....##.#..###...####.##.#.....#..###...#....####.#####.##..##.###
#....#######.####.###...#####.###..#.#.....#.#.#......###.....#...#.#..###.#.##...#..#.##..#.#..#.##
.#..##.#..#.##..#..###..###.##...###.###..####...#####.###..#..####.#.#.####...###.####.#.####.##..#
#..###..##.#####.....#..####.##.#.##....##....###..#####.#.###....###..#.#..##.#....##.###.####..##.
.###.##.#.##.#.#..#.####.#...###...##..#.#.#.#..#..#.#.#..####.....##...#.#.#....#.##.###......#.##.
#...#...##...##.##..###..########.#.####.##..#..##.#.##...###..##.#.##.#.#...#####.#####...###.##...
.....#..#..##....####....#....#..###.##..#.#..####.###.....##..######.###..########.##.#.##..#.....#
..###.##.##.####........#....###.#.###.#.###..###.#####..###.#...#..#.####.#####.########...##.##.#.
.#.#.#.####.#.###..#..#####.##.#.#.####.#.##.#..###.##.#.#....#..##..##.#####.###...#..#.###....#.#.
###.#.#.#.#..#####.#.###...#..##.......#.##.#...#####.######......###..###.#....##..#...##.#.#...#..
..##.#.##.##.....###.....#.#.#.##...##..###.#.#.....###..##.#####.#.#..#.##..#..####.###...#.##.#...
#.###..#.....###.##......####.#......#.#..#.##.##.#..###.#.####.....#.#...#...#..#.##.#.....##.#....
.##.#.##....#..##.#.#...#.####.##.##.#.##.#..#.###.###.#.#...####.#.###....#.#.#..##..#.#..##....##.
..##..#.#..#.##.#..###...#.#.#..#.....##...##.#####.######..####.#...##.##..#.##.#..#.##...###.##.#.
..##.#..#.#......##..#.####..#...##.#.#..#.#.#.##.#.#......#####.##.##.####.##...#...#.#.##.#..##.##
#..#.#.#.####.#.#.#.##.....#.#..#.#..####.#..#.####..##..#.##...#.#####..###....#...#...#....##.##..
..#.......#.##.....##..########.##.#..#.....##...#..#..#...##..#....#...#..#......#..#####..#.##..#.
..#.##..#...#..#..#.##..#...##.##...#..#..###.#.#.#.##.##.#.#.##.#..#.##..#.#..###.###.#..##....#.##
#..#.#..#.##...#..##...##..##..#######.#...####..##..#.####.###.##.##.#....####.#..##.##..#.#...##..
.##...#.##...####..#.####.#..###..##..####..##..#.##.#####.#####.#.....#..#...#..##.##.##..####.....
##...#.######.#...##..###.#.#.#...##.#.#.#.#.#....##.##.###.#.#.#####.....#.#.##.........##..#######
.#.###.##.#.#..##..#..#.#..###.#.#.#.##.##.##..##.###..#..#..#...#####.###...#..#..#.#....#....#..#.
.##.#...#.###...#.####..##.##.#####.#.####..##....#..###...#..#..#.#.##.....#.##.#.##..........#.#..
####.#.#.#.#.####..#.....#..##.#...##.###.##.#..##..#..###..#...##..#.##..#.####.#..####.....#.#.###
.#.###...#.###..#.#.....#..#......#.#.#.##..#..#####....##..#.#..##########.##.#####...##.###...#...
.#.#.....##.####.#..#####...##.##.....#...#.##.#.####.#.##..#....#....#.#.#.#.##...#....##..##.##..#
.#....#.#.##..#.##.###...###....##........#.#....#.#.###.##.####.#..#.####.####......#...#.####...#.
#######..##....###.##..###..#..#...#.....#.....#...#..#.#######.#.#...#..#.###..###.#.#...###.....##
##..##..#..##...#.#.#.##.#....#.#.#.#.#..###.##..###.##.#..###..###.#.#.#....#.####..##...#...#####.
.#..#.#..#.#......#..####.###.#.#.##.#.#.####.###...#.##.#.##..##...#.#..#..##.###...#.#.########..#
#.#.########.#..#.#.##.###..##.#.###.#..#....####....##..###..###..#.#.#####..######.####.##..##.#..
###...##.#...#.#.#.#..##.###..###..##..##.#...####..#.#...#..###..#........##.#.##.###..#..###...###
###.#.#########.####.##...###.#...#.#..#.##.#..##..#.##.####...#.###..#...##..##...##.#.####..##..#.
.#...####..#...###....#.....#####.#.######....#.#####.#.##..##.##..#.##.......###.#............#.#.#`
